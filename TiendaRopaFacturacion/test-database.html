<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Base de Datos - DE MODA CON VIVI</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .section h2 { color: #333; margin-bottom: 15px; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .data-display { background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px; max-height: 300px; overflow-y: auto; }
        .log-output { background: #e9ecef; padding: 15px; border-radius: 5px; margin-top: 20px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóÑÔ∏è Test de Base de Datos - DE MODA CON VIVI</h1>
        <p>Esta p√°gina permite probar la nueva estructura de base de datos implementada seg√∫n el diagrama proporcionado.</p>
        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            <strong>‚ö†Ô∏è Nota Importante:</strong> Los datos se mantienen solo en memoria. Al cerrar la pesta√±a o reiniciar el servidor, todos los datos se reinician a su estado original.
        </div>

        <div class="section">
            <h2>üìä Estad√≠sticas Generales</h2>
            <button class="btn btn-primary" onclick="loadStats()">Cargar Estad√≠sticas</button>
            <div id="stats-display" class="data-display"></div>
        </div>

        <div class="section">
            <h2>üë• Clientes</h2>
            <button class="btn btn-primary" onclick="loadClients()">Cargar Clientes</button>
            <button class="btn btn-success" onclick="addTestClient()">Agregar Cliente de Prueba</button>
            <div id="clients-display" class="data-display"></div>
        </div>

        <div class="section">
            <h2>üëó Categor√≠as y Productos de Ropa</h2>
            <button class="btn btn-primary" onclick="loadRopaCategories()">Cargar Categor√≠as</button>
            <button class="btn btn-info" onclick="loadRopaProducts()">Cargar Productos</button>
            <div id="ropa-display" class="data-display"></div>
        </div>

        <div class="section">
            <h2>üç≠ Categor√≠as y Productos de Chucher√≠as</h2>
            <button class="btn btn-primary" onclick="loadChucheriasCategories()">Cargar Categor√≠as</button>
            <button class="btn btn-info" onclick="loadChucheriasProducts()">Cargar Productos</button>
            <div id="chucherias-display" class="data-display"></div>
        </div>

        <div class="section">
            <h2>üí∞ Ventas de Ropa</h2>
            <button class="btn btn-primary" onclick="loadRopaSales()">Cargar Ventas</button>
            <button class="btn btn-success" onclick="createTestRopaSale()">Crear Venta de Prueba</button>
            <div id="ropa-sales-display" class="data-display"></div>
        </div>

        <div class="section">
            <h2>üç≠ Ventas de Chucher√≠as</h2>
            <button class="btn btn-primary" onclick="loadChucheriasSales()">Cargar Ventas</button>
            <button class="btn btn-success" onclick="createTestChucheriasSale()">Crear Venta de Prueba</button>
            <div id="chucherias-sales-display" class="data-display"></div>
        </div>

        <div class="section">
            <h2>üßπ Limpieza</h2>
            <button class="btn btn-danger" onclick="clearDatabase()">Limpiar Base de Datos</button>
            <button class="btn btn-info" onclick="reinitializeDatabase()">Reinicializar Base de Datos</button>
        </div>

        <div class="log-output" id="log-output">
            <h3>Registro de Acciones:</h3>
        </div>
    </div>

    <script src="js/database.js"></script>
    <script>
        const logOutput = document.getElementById('log-output');

        function log(message) {
            const p = document.createElement('p');
            p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logOutput.appendChild(p);
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        function loadStats() {
            try {
                const stats = window.database.getStats();
                document.getElementById('stats-display').innerHTML = `
                    <h3>Estad√≠sticas Generales</h3>
                    <p><strong>Total de Ventas:</strong> ${stats.totalVentas}</p>
                    <p><strong>Total de Facturas:</strong> ${stats.totalFacturas}</p>
                    <p><strong>Total de Clientes:</strong> ${stats.totalClientes}</p>
                    <p><strong>Ingresos Totales:</strong> $${stats.totalIngresos.toFixed(2)}</p>
                    <p><strong>Ingresos Ropa:</strong> $${stats.ingresosRopa.toFixed(2)}</p>
                    <p><strong>Ingresos Chucher√≠as:</strong> $${stats.ingresosChucheria.toFixed(2)}</p>
                `;
                log('‚úÖ Estad√≠sticas cargadas correctamente');
            } catch (error) {
                log('‚ùå Error al cargar estad√≠sticas: ' + error.message);
            }
        }

        function loadClients() {
            try {
                const clients = window.database.getAllClients();
                let html = '<h3>Clientes</h3><table><tr><th>C√©dula</th><th>Nombre</th><th>Ciudad</th><th>Tel√©fono</th></tr>';
                clients.forEach(client => {
                    html += `<tr><td>${client.cedula}</td><td>${client.nombre}</td><td>${client.ciudad}</td><td>${client.telefono || '-'}</td></tr>`;
                });
                html += '</table>';
                document.getElementById('clients-display').innerHTML = html;
                log(`‚úÖ ${clients.length} clientes cargados`);
            } catch (error) {
                log('‚ùå Error al cargar clientes: ' + error.message);
            }
        }

        function addTestClient() {
            try {
                const newClient = window.database.addClient({
                    nombre: 'Cliente de Prueba',
                    ciudad: 'Quito',
                    telefono: '0999999999',
                    direccion: 'Calle de Prueba 123',
                    observacion: 'Cliente creado para pruebas'
                });
                log(`‚úÖ Cliente agregado: ${newClient.nombre} (C√©dula: ${newClient.cedula})`);
                loadClients();
            } catch (error) {
                log('‚ùå Error al agregar cliente: ' + error.message);
            }
        }

        function loadRopaCategories() {
            try {
                const categories = window.database.getCategoriasRopa();
                let html = '<h3>Categor√≠as de Ropa</h3><table><tr><th>ID</th><th>Nombre</th></tr>';
                categories.forEach(cat => {
                    html += `<tr><td>${cat.id}</td><td>${cat.name}</td></tr>`;
                });
                html += '</table>';
                document.getElementById('ropa-display').innerHTML = html;
                log(`‚úÖ ${categories.length} categor√≠as de ropa cargadas`);
            } catch (error) {
                log('‚ùå Error al cargar categor√≠as de ropa: ' + error.message);
            }
        }

        function loadRopaProducts() {
            try {
                const products = window.database.getTable('ropa');
                let html = '<h3>Productos de Ropa</h3><table><tr><th>ID</th><th>Nombre</th><th>Precio</th><th>Categor√≠a ID</th></tr>';
                products.forEach(product => {
                    html += `<tr><td>${product.id}</td><td>${product.nombre}</td><td>$${product.precio.toFixed(2)}</td><td>${product.idCategoriaRopa}</td></tr>`;
                });
                html += '</table>';
                document.getElementById('ropa-display').innerHTML = html;
                log(`‚úÖ ${products.length} productos de ropa cargados`);
            } catch (error) {
                log('‚ùå Error al cargar productos de ropa: ' + error.message);
            }
        }

        function loadChucheriasCategories() {
            try {
                const categories = window.database.getCategoriasChucherias();
                let html = '<h3>Categor√≠as de Chucher√≠as</h3><table><tr><th>ID</th><th>Nombre</th></tr>';
                categories.forEach(cat => {
                    html += `<tr><td>${cat.id}</td><td>${cat.name}</td></tr>`;
                });
                html += '</table>';
                document.getElementById('chucherias-display').innerHTML = html;
                log(`‚úÖ ${categories.length} categor√≠as de chucher√≠as cargadas`);
            } catch (error) {
                log('‚ùå Error al cargar categor√≠as de chucher√≠as: ' + error.message);
            }
        }

        function loadChucheriasProducts() {
            try {
                const products = window.database.getTable('chucherias');
                let html = '<h3>Productos de Chucher√≠as</h3><table><tr><th>ID</th><th>Nombre</th><th>Precio</th><th>Categor√≠a ID</th></tr>';
                products.forEach(product => {
                    html += `<tr><td>${product.id}</td><td>${product.nombre}</td><td>$${product.precio.toFixed(2)}</td><td>${product.idCategoriaChucheria}</td></tr>`;
                });
                html += '</table>';
                document.getElementById('chucherias-display').innerHTML = html;
                log(`‚úÖ ${products.length} productos de chucher√≠as cargados`);
            } catch (error) {
                log('‚ùå Error al cargar productos de chucher√≠as: ' + error.message);
            }
        }

        function loadRopaSales() {
            try {
                const sales = window.database.getVentasRopaCompletas();
                let html = '<h3>Ventas de Ropa</h3><table><tr><th>ID</th><th>Cliente</th><th>Producto</th><th>Cantidad</th><th>Fecha</th></tr>';
                sales.forEach(sale => {
                    html += `<tr><td>${sale.id}</td><td>${sale.cliente?.nombre || 'N/A'}</td><td>${sale.producto?.nombre || 'N/A'}</td><td>${sale.cantidad}</td><td>${sale.fecha}</td></tr>`;
                });
                html += '</table>';
                document.getElementById('ropa-sales-display').innerHTML = html;
                log(`‚úÖ ${sales.length} ventas de ropa cargadas`);
            } catch (error) {
                log('‚ùå Error al cargar ventas de ropa: ' + error.message);
            }
        }

        function createTestRopaSale() {
            try {
                const clients = window.database.getAllClients();
                const products = window.database.getTable('ropa');
                
                if (clients.length === 0 || products.length === 0) {
                    log('‚ùå No hay clientes o productos disponibles para crear venta de prueba');
                    return;
                }

                const client = clients[0];
                const product = products[0];

                const venta = window.database.createVentaRopa({
                    fecha: new Date().toISOString().split('T')[0],
                    idCliente: client.cedula,
                    idRopa: product.id,
                    cantidad: 2
                });

                const factura = window.database.createFacturaRopa({
                    idVentasRopa: venta.id,
                    subtotal: product.precio * 2,
                    total: product.precio * 2
                });

                log(`‚úÖ Venta de ropa creada: Funda ${factura.funda} - ${product.nombre} x2`);
                loadRopaSales();
            } catch (error) {
                log('‚ùå Error al crear venta de ropa: ' + error.message);
            }
        }

        function loadChucheriasSales() {
            try {
                const sales = window.database.getVentasChucheriaCompletas();
                let html = '<h3>Ventas de Chucher√≠as</h3><table><tr><th>ID</th><th>Cliente</th><th>Producto</th><th>Cantidad</th><th>Fecha</th></tr>';
                sales.forEach(sale => {
                    html += `<tr><td>${sale.id}</td><td>${sale.cliente?.nombre || 'N/A'}</td><td>${sale.producto?.nombre || 'N/A'}</td><td>${sale.cantidad}</td><td>${sale.fecha}</td></tr>`;
                });
                html += '</table>';
                document.getElementById('chucherias-sales-display').innerHTML = html;
                log(`‚úÖ ${sales.length} ventas de chucher√≠as cargadas`);
            } catch (error) {
                log('‚ùå Error al cargar ventas de chucher√≠as: ' + error.message);
            }
        }

        function createTestChucheriasSale() {
            try {
                const clients = window.database.getAllClients();
                const products = window.database.getTable('chucherias');
                
                if (clients.length === 0 || products.length === 0) {
                    log('‚ùå No hay clientes o productos disponibles para crear venta de prueba');
                    return;
                }

                const client = clients[0];
                const product = products[0];

                const venta = window.database.createVentaChucheria({
                    fecha: new Date().toISOString().split('T')[0],
                    idCliente: client.cedula,
                    idChucherias: product.id,
                    cantidad: 3
                });

                const factura = window.database.createFacturaChucheria({
                    idVentasChucheria: venta.id,
                    subtotal: product.precio * 3,
                    total: product.precio * 3
                });

                log(`‚úÖ Venta de chucher√≠as creada: Funda ${factura.funda} - ${product.nombre} x3`);
                loadChucheriasSales();
            } catch (error) {
                log('‚ùå Error al crear venta de chucher√≠as: ' + error.message);
            }
        }

        function clearDatabase() {
            try {
                // Recargar la p√°gina para reinicializar (los datos ya est√°n en memoria)
                log('‚úÖ Recargando p√°gina para reinicializar base de datos...');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } catch (error) {
                log('‚ùå Error al reinicializar base de datos: ' + error.message);
            }
        }

        function reinitializeDatabase() {
            try {
                // Reinicializar la base de datos en memoria
                window.database.initializeDatabase();
                log('‚úÖ Base de datos reinicializada en memoria');
                loadStats();
            } catch (error) {
                log('‚ùå Error al reinicializar base de datos: ' + error.message);
            }
        }

        // Cargar datos iniciales al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ P√°gina de prueba cargada');
            loadStats();
        });
    </script>
</body>
</html>
